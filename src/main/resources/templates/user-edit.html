<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit User - Invoice Generator</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <div class="container">
        <div th:replace="~{fragments/header :: header}"></div>
        <h1>Edit User</h1>
        
        <div class="form-section" style="max-width: 600px; margin: 0 auto;">
            <form method="post" th:action="@{/user/edit/{id}(id=${user.id})}">
                <div class="form-row">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" name="username" th:value="${user.username}" required>
                    </div>
                    <div class="form-group">
                        <label>Email ID</label>
                        <input type="email" name="emailId" th:value="${user.emailId}">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>GSTIN</label>
                        <input type="text" name="gstin" th:value="${user.gstin}" pattern="[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}" title="Enter valid GSTIN (e.g., 27XXXXX1234X1Z5)">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>First Name</label>
                        <input type="text" name="firstName" th:value="${user.firstName}" required>
                    </div>
                    <div class="form-group">
                        <label>Last Name</label>
                        <input type="text" name="lastName" th:value="${user.lastName}" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>User Type</label>
                        <select name="userType" style="width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                            <option value="user" th:selected="${user.userType == 'user'}">User</option>
                            <option value="admin" th:selected="${user.userType == 'admin'}">Admin</option>
                            <option value="client" th:selected="${user.userType == 'client'}">Client</option>
                        </select>
                    </div>
                </div>
                <div class="actions">
                    <button type="submit" class="btn btn-primary">Update User</button>
                    <a th:href="@{/user/list}" class="btn">Cancel</a>
                </div>
            </form>
        </div>
        
        <div class="form-section" style="max-width: 800px; margin: 20px auto;">
            <h3>Address Details</h3>
            <form method="post" th:action="@{/address/save}" th:object="${address}">
                <input type="hidden" name="entityType" value="USER">
                <input type="hidden" name="entityId" th:value="${user.id}">
                <input type="hidden" name="returnUrl" th:value="@{/user/edit/{id}(id=${user.id})}">
                <input type="hidden" th:field="*{id}">
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Address Type</label>
                        <select th:field="*{addressType}" style="width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 8px;" th:disabled="${session.userType != 'admin'}">
                            <option value="home">Home</option>
                            <option value="office">Office</option>
                            <option value="others">Others</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>House No</label>
                        <input type="text" th:field="*{houseNo}" th:readonly="${session.userType != 'admin'}">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Address Line 1</label>
                        <input type="text" th:field="*{address1}" th:readonly="${session.userType != 'admin'}">
                    </div>
                    <div class="form-group">
                        <label>Address Line 2</label>
                        <input type="text" th:field="*{address2}" th:readonly="${session.userType != 'admin'}">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>State</label>
                        <select id="stateSelect" th:field="*{state}" onchange="updateCities()" style="width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 8px;" th:disabled="${session.userType != 'admin'}">
                            <option value="">Select State</option>
                            <option value="Andhra Pradesh">Andhra Pradesh</option>
                            <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                            <option value="Assam">Assam</option>
                            <option value="Bihar">Bihar</option>
                            <option value="Chhattisgarh">Chhattisgarh</option>
                            <option value="Goa">Goa</option>
                            <option value="Gujarat">Gujarat</option>
                            <option value="Haryana">Haryana</option>
                            <option value="Himachal Pradesh">Himachal Pradesh</option>
                            <option value="Jharkhand">Jharkhand</option>
                            <option value="Karnataka">Karnataka</option>
                            <option value="Kerala">Kerala</option>
                            <option value="Madhya Pradesh">Madhya Pradesh</option>
                            <option value="Maharashtra">Maharashtra</option>
                            <option value="Manipur">Manipur</option>
                            <option value="Meghalaya">Meghalaya</option>
                            <option value="Mizoram">Mizoram</option>
                            <option value="Nagaland">Nagaland</option>
                            <option value="Odisha">Odisha</option>
                            <option value="Punjab">Punjab</option>
                            <option value="Rajasthan">Rajasthan</option>
                            <option value="Sikkim">Sikkim</option>
                            <option value="Tamil Nadu">Tamil Nadu</option>
                            <option value="Telangana">Telangana</option>
                            <option value="Tripura">Tripura</option>
                            <option value="Uttar Pradesh">Uttar Pradesh</option>
                            <option value="Uttarakhand">Uttarakhand</option>
                            <option value="West Bengal">West Bengal</option>
                            <option value="Delhi">Delhi</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>City</label>
                        <select id="citySelect" th:field="*{city}" style="width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 8px;" th:disabled="${session.userType != 'admin'}">
                            <option value="">Select City</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Country</label>
                        <input type="text" name="country" th:value="${address.country != null and address.country != '' ? address.country : 'India'}" readonly style="background: #f5f5f5;">
                    </div>
                    <div class="form-group">
                        <label>Pincode</label>
                        <input type="text" th:field="*{pincode}" th:readonly="${session.userType != 'admin'}">
                    </div>
                </div>
                <div class="actions" th:if="${session.userType == 'admin'}">
                    <button type="submit" class="btn btn-primary">Save Address</button>
                </div>
            </form>
        </div>
        
        <div class="footer">
            <p>Copyright Â© KVR Associates</p>
        </div>
    </div>
    <script th:src="@{/js/state-city.js}"></script>
    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            const currentState = /*[[${address.state}]]*/ '';
            const currentCity = /*[[${address.city}]]*/ '';
            initializeStateCity(currentState, currentCity);
        });
    </script>
    <script th:replace="~{fragments/header :: menuScript}"></script>
</body>
</html>
